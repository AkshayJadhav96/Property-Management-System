{% extends "base.html" %}
{% block title %}Agent Dashboard{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">

  <!-- Page Heading -->
  <h1 class="text-3xl font-bold text-gray-800 mb-6">Agent Dashboard</h1>

  <div class="p-5">
  <a href="{{ url_for('add_property') }}" 
     class="inline-block bg-indigo-600 text-white px-5 py-2 rounded-lg shadow hover:bg-indigo-700 transition">
      Add New Property
  </a>
  </div>

  <!-- Agent Properties -->
  <div class="bg-white shadow-md rounded-lg p-6 mb-8">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Your Properties</h2>
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Title</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Description</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Size</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Price</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Address</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% for prop in properties %}
          <tr>
            <td class="px-4 py-2">{{ prop.title }}</td>
            <td class="px-4 py-2">{{ prop.description }}</td>
            <td class="px-4 py-2">{{ prop.size }}</td>
            <td class="px-4 py-2">₹{{ prop.price }}</td>
            <td class="px-4 py-2">{{ prop.address }}</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="px-4 py-2 text-gray-500">No properties found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Active Leases -->
  <div class="bg-white shadow-md rounded-lg p-6 mb-8">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Active Leases</h2>
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Tenant</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Property</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Rent</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Start Date</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">End Date</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% for lease in active_leases %}
          <tr>
            <td class="px-4 py-2">{{ lease.property_title }}</td>
            <td class="px-4 py-2">{{ lease.tenant_name }}</td>
            <td class="px-4 py-2">₹{{ lease.rent }}</td>
            <td class="px-4 py-2">{{ lease.start_date }}</td>
            <td class="px-4 py-2">{{ lease.end_date }}</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="px-4 py-2 text-gray-500">No active leases found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Rental Requests -->
  <div class="bg-white shadow-md rounded-lg p-6">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Rental Requests</h2>
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Requester</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Property</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-500">Status</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
<!-- # # # # # #  # -->
      {% for req in rental_requests %}
        <tr>
          <td class="px-4 py-2">{{ req.tenant_name }}</td>
          <td class="px-4 py-2">{{ req.property_title }}</td>
          <td class="px-4 py-2">
            {% if req.request_status == 'pending' %}
              <form method="POST" action="{{ url_for('handle_rental_request', request_id=req.request_id, action='accept') }}" style="display:inline;">
                <button type="submit" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">
                  Accept
                </button>
              </form>
              <form method="POST" action="{{ url_for('handle_rental_request', request_id=req.request_id, action='reject') }}" style="display:inline;">
                <button type="submit" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                  Reject
                </button>
              </form>
            {% else %}
              <span class="px-3 py-1 rounded {{ 'bg-green-100 text-green-700' if req.request_status=='accepted' else 'bg-red-100 text-red-700' }}">
                {{ req.request_status|capitalize }}
              </span>
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="3" class="px-4 py-2 text-gray-500">No rental requests found.</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}

<!-- # # # # # # # #  -->