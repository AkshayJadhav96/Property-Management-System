{% extends "base.html" %}

{% block title %}Tenant Dashboard{% endblock %}

{% block content %}
<div class="content-card max-w-4xl mx-auto">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Welcome, {{ session.username }}</h2>

    <!-- Tab Navigation -->
    <div class="flex border-b border-gray-200 mb-6">
        <button class="tab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 focus:outline-none active" data-tab="leases">My Lease</button>
        <button class="tab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 focus:outline-none" data-tab="requests">My Rental Requests</button>
        <button class="tab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 focus:outline-none" data-tab="properties">Available Properties</button>
    </div>

    <!-- Tab Content -->
    <div id="leases" class="tab-content">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">My Lease</h3>
        {% if leases %}
            {% for lease in leases %}
                <div class="bg-gray-50 p-4 rounded-md shadow-sm mb-4">
                    <p><strong>Property:</strong> {{ lease.title }} ({{ lease.address }})</p>
                    <p><strong>Rent:</strong> ₹{{ lease.rent }}</p>
                    <p><strong>Lease Period:</strong> {{ lease.start_date }} to {{ lease.end_date }}</p>
                    <p><strong>Status:</strong> {{ lease.status }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-gray-600">You have no active lease. <a href="#properties" class="text-blue-600 hover:underline" onclick="switchTab('properties')">Browse available properties</a>.</p>
        {% endif %}
    </div>

    <div id="requests" class="tab-content hidden">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">My Rental Requests</h3>
        {% if requests %}
            <ul class="space-y-3">
                {% for r in requests %}
                    <li class="bg-gray-50 p-3 rounded-md shadow-sm">
                        {{ r.property_title }} - Status: {{ r.status }} - Request Date: {{ r.request_date }}
                    </li>
                {% endfor %}
            </ul>
            <!-- Placeholder for pagination -->
            {% if requests|length > 5 %}
                <div class="mt-4 text-center">
                    <button class="btn" disabled>Load More (Pagination TBD)</button>
                </div>
            {% endif %}
        {% else %}
            <p class="text-gray-600">No rental requests submitted. <a href="#properties" class="text-blue-600 hover:underline" onclick="switchTab('properties')">Browse available properties</a>.</p>
        {% endif %}
    </div>

    <div id="properties" class="tab-content hidden">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Available Properties</h3>
        {% if properties %}
            {% for prop in properties %}
                <div class="bg-gray-50 p-4 rounded-md shadow-sm mb-4">
                    <p><strong>Property:</strong> {{ prop.title }} ({{ prop.address }})</p>
                    <p><strong>Description:</strong> {{ prop.description }}</p>
                    <p><strong>Type:</strong> {{ prop.type }}</p>
                    <p><strong>Size:</strong> {{ prop.size }} sq.ft</p>
                    <p><strong>Rent:</strong> ₹{{ prop.price }}</p>
                    <form method="POST" class="mt-2">
                        <button type="submit" class="btn">Request to Rent</button>
                    </form>
                </div>
            {% endfor %}
            <!-- Placeholder for pagination -->
            {% if properties|length > 5 %}
                <div class="mt-4 text-center">
                    <button class="btn" disabled>Load More (Pagination TBD)</button>
                </div>
            {% endif %}
        {% else %}
            <p class="text-gray-600">No properties available at the moment.</p>
        {% endif %}
    </div>
</div>

<!-- Simple JavaScript for tab switching -->
<script>
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active', 'border-blue-600', 'text-blue-600'));
        
        document.getElementById(tabId).classList.remove('hidden');
        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active', 'border-blue-600', 'text-blue-600');
    }

    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => switchTab(button.dataset.tab));
    });

    // Show the first tab by default
    switchTab('leases');
</script>
{% endblock %}